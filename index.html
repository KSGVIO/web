<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GitHub Repo File Index</title>
  <style>
    :root{--bg:#0b0f14;--card:#111826;--muted:#6b7280;--text:#e5e7eb;--accent:#60a5fa;--border:#1f2937;--ok:#10b981;--warn:#f59e0b;--err:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:linear-gradient(180deg,#0b0f14,#0b0f14 30%,#0d1117);color:var(--text)}
    header{position:sticky;top:0;background:rgba(11,15,20,.9);backdrop-filter:blur(6px);border-bottom:1px solid var(--border);z-index:10}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:20px;font-weight:600;letter-spacing:.2px}
    .cfg{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    input{background:#0f1623;border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px;outline:none}
    input:focus{border-color:var(--accent)}
    button{background:var(--accent);color:#081018;border:none;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    main{max-width:1100px;margin:20px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.25);display:flex;flex-direction:row}
    .toolbar{display:flex;align-items:center;gap:10px;padding:12px;border-bottom:1px solid var(--border)}
    .toolbar input{flex:1}
    .crumbs{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
    .crumbs a{color:var(--accent);text-decoration:none}
    .crumbs .sep{color:var(--muted)}
    .list{width:60%;border-right:1px solid var(--border)}
    .preview{width:40%;padding:12px;overflow:auto}
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px 14px;border-bottom:1px solid var(--border);font-size:14px}
    th{user-select:none;text-align:left;color:#cbd5e1}
    tr:hover{background:#0f1623}
    .muted{color:var(--muted)}
    .tag{font-size:12px;border:1px solid var(--border);padding:2px 8px;border-radius:999px;color:#9ca3af}
    .row{display:flex;align-items:center;gap:10px;cursor:pointer}
    .dir, .file{display:inline-flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
    .dir svg, .file svg{opacity:.9}
    .footer{padding:14px;color:var(--muted);font-size:12px;border-top:1px solid var(--border)}
    .status{display:flex;gap:10px;align-items:center}
    .status .dot{width:8px;height:8px;border-radius:50%}
    .ok{background:var(--ok)}.warn{background:var(--warn)}.err{background:var(--err)}
    .hidden{display:none}
    .notice{padding:12px 14px;color:#fef3c7;background:#78350f20;border-top:1px solid #78350f40}
    @media (max-width:640px){
      .list{width:100%;}
      .preview{display:none}
      th:nth-child(3),td:nth-child(3){display:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>GitHub Repo File Index</h1>
      <div class="cfg">
        <input id="owner" placeholder="owner (e.g. vercel)" />
        <input id="repo" placeholder="repo (e.g. next.js)" />
        <input id="branch" placeholder="branch (e.g. main)" />
        <button id="loadBtn">Load</button>
        <span class="tag" id="rateTag">rate: unknown</span>
      </div>
    </div>
  </header>
  <main>
    <div class="card">
      <div class="list">
        <div class="toolbar">
          <div class="crumbs" id="breadcrumbs"></div>
          <input id="search" placeholder="Filter files… (name contains)" />
        </div>
        <div id="notice" class="notice hidden"></div>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Type</th>
              <th>Size</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div class="footer">
          <div class="status" id="status"><span class="dot warn"></span> Ready</div>
        </div>
      </div>
      <div class="preview" id="preview">Select a file to preview</div>
    </div>
  </main>

  <script>
    const DEFAULTS = { owner:"", repo:"", branch:"main" };
    const params = new URLSearchParams(location.search);
    const qs = (k, def="") => params.get(k) || def;

    const els = {
      owner: document.getElementById('owner'),
      repo: document.getElementById('repo'),
      branch: document.getElementById('branch'),
      loadBtn: document.getElementById('loadBtn'),
      breadcrumbs: document.getElementById('breadcrumbs'),
      tbody: document.getElementById('tbody'),
      status: document.getElementById('status'),
      notice: document.getElementById('notice'),
      search: document.getElementById('search'),
      rateTag: document.getElementById('rateTag'),
      preview: document.getElementById('preview'),
    };

    els.owner.value = qs('owner', DEFAULTS.owner);
    els.repo.value = qs('repo', DEFAULTS.repo);
    els.branch.value = qs('branch', DEFAULTS.branch);

    const state = { path: decodeURIComponent(location.hash.replace(/^#/, '')) || '', entries: [], filter: '' };

    const api = (o,r,p,b) => `https://api.github.com/repos/${o}/${r}/contents/${encodeURIComponent(p)}?ref=${encodeURIComponent(b)}`;
    const rawUrl = (o,r,fp,b) => `https://raw.githubusercontent.com/${o}/${r}/${encodeURIComponent(b)}/${fp}`;

    function setStatus(kind,msg){ els.status.innerHTML=''; const dot=document.createElement('span'); dot.className='dot '+(kind||'warn'); els.status.appendChild(dot); els.status.appendChild(document.createTextNode(' '+msg)); }
    function setNotice(t){ if(!t){ els.notice.classList.add('hidden'); els.notice.textContent=''; return; } els.notice.classList.remove('hidden'); els.notice.textContent=t; }

    function updateBreadcrumbs(owner,repo,branch){
      const parts=state.path.split('/').filter(Boolean); const frag=document.createDocumentFragment();
      const root=document.createElement('a'); root.href='#'; root.textContent=owner&&repo?`${owner}/${repo}@${branch}`:'root'; root.onclick=(e)=>{e.preventDefault();navigate('');}; frag.appendChild(root);
      let acc=''; for(const [i,part] of parts.entries()){ frag.appendChild(spanSep()); const a=document.createElement('a'); acc+=(i?'/':'')+part; a.href='#'+acc; a.textContent=part; a.onclick=(e)=>{e.preventDefault();navigate(acc);}; frag.appendChild(a);} els.breadcrumbs.innerHTML=''; els.breadcrumbs.appendChild(frag);
    }
    function spanSep(){ const s=document.createElement('span'); s.className='sep'; s.textContent=' / '; return s; }
    function fmtSize(bytes){ if(bytes==null)return''; const u=['B','KB','MB','GB']; let i=0,n=bytes; while(n>=1024&&i<u.length-1){n/=1024;i++;} return (Math.round(n*10)/10)+' '+u[i]; }
    function icon(kind){ const svg=kind==='dir'?`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6z" stroke="currentColor" stroke-width="1.5"/></svg>`:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 3h7l5 5v11a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.5"/></svg>`; const span=document.createElement('span'); span.innerHTML=svg; return span.firstChild; }

    function renderTable(owner,repo,branch){
      updateBreadcrumbs(owner,repo,branch);
      let rows=state.entries.slice();
      if(state.filter){ const q=state.filter.toLowerCase(); rows=rows.filter(x=>x.name.toLowerCase().includes(q)); }
      rows.sort((a,b)=>(a.type===b.type?a.name.localeCompare(b.name):a.type==='dir'?-1:1));
      els.tbody.innerHTML='';
      for(const it of rows){
        const tr=document.createElement('tr');
        const nameTd=document.createElement('td'); const typeTd=document.createElement('td'); const sizeTd=document.createElement('td');
        const rowDiv=document.createElement('div'); rowDiv.className='row';

        rowDiv.onclick=(e)=>{ e.preventDefault(); if(it.type==='dir'){navigate(joinPath(state.path,it.name));} else {showPreview(owner,repo,branch,joinPath(state.path,it.name));}};

        const iconEl=icon(it.type==='dir'?'dir':'file');
        const text=document.createElement('span'); text.textContent=it.name;
        rowDiv.appendChild(iconEl);
        rowDiv.appendChild(text);

        nameTd.appendChild(rowDiv);
        typeTd.textContent=it.type; sizeTd.textContent=it.type==='file'?fmtSize(it.size):'';
        tr.appendChild(nameTd); tr.appendChild(typeTd); tr.appendChild(sizeTd);
        els.tbody.appendChild(tr);
      }
    }

    function joinPath(a,b){ return [a,b].filter(Boolean).join('/'); }

    async function fetchContents(o,r,p,b){
      const url=api(o,r,p,b); setStatus('warn','Loading '+(p||'/')+' …'); setNotice('');
      try{
        const res=await fetch(url); updateRate(res.headers);
        if(!res.ok){ setNotice('Error '+res.status+' '+res.statusText); setStatus('err','Error'); state.entries=[]; renderTable(o,r,b); return; }
        const data=await res.json();
        if(!Array.isArray(data)){ setNotice('This path is a file.'); state.entries=[]; renderTable(o,r,b); return; }
        state.entries=data.map(x=>({name:x.name,path:x.path,type:x.type,size:x.size??null}));
        renderTable(o,r,b); setStatus('ok','Loaded '+(p||'/'));
      }catch(err){ console.error(err); setNotice('Network error: '+err.message); setStatus('err','Network error'); }
    }

    function navigate(path){ state.path=path||''; location.hash=encodeURIComponent(state.path); doLoad(); }

    function doLoad(){ const o=els.owner.value.trim(); const r=els.repo.value.trim(); const b=els.branch.value.trim()||'main'; if(!o||!r){ setNotice('Set owner and repo above.'); setStatus('warn','Awaiting configuration'); els.tbody.innerHTML=''; updateBreadcrumbs(o,r,b); return; } fetchContents(o,r,state.path,b); }

    function updateRate(h){ const rem=h.get('x-ratelimit-remaining'); const lim=h.get('x-ratelimit-limit'); els.rateTag.textContent=rem&&lim?`rate: ${rem}/${lim}`:'rate: n/a'; }

    function showPreview(o,r,b,fp){
      const url=rawUrl(o,r,fp,b);
      const ext=fp.split('.').pop().toLowerCase();
      els.preview.innerHTML='';
      if(['png','jpg','jpeg','gif','webp'].includes(ext)){
        const img=document.createElement('img'); img.src=url; img.style.maxWidth='100%'; img.style.borderRadius='8px'; els.preview.appendChild(img);
      } else if(['mp4','webm'].includes(ext)){
        const v=document.createElement('video'); v.src=url; v.controls=true; v.style.maxWidth='100%'; els.preview.appendChild(v);
      } else if(['mp3','wav','ogg'].includes(ext)){
        const a=document.createElement('audio'); a.src=url; a.controls=true; els.preview.appendChild(a);
      } else {
        els.preview.textContent='No preview available for this file.';
      }
    }

    els.loadBtn.addEventListener('click',()=>{ state.path=''; location.hash=''; doLoad(); });
    window.addEventListener('hashchange',()=>{ state.path=decodeURIComponent(location.hash.replace(/^#/,'')); doLoad(); });
    els.search.addEventListener('input',(e)=>{ state.filter=e.target.value; const o=els.owner.value,r=els.repo.value,b=els.branch.value||'main'; renderTable(o,r,b); });
    if(els.owner.value&&els.repo.value){ doLoad(); }
  </script>
</body>
</html>
